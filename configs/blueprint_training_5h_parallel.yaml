# Configuration optimisée pour Mac M2 avec parallélisation
# Basé sur blueprint_training_5h.yaml avec ajout de num_workers

# Training mode: time-budget
time_budget_seconds: 18000  # 5 hours
snapshot_interval_seconds: 900  # Save snapshots every 15 minutes (5h = ~20 snapshots)

# Parallélisation (NOUVEAU - résout le problème --num-workers)
num_workers: 0  # 0 = auto-detect (utilise tous les cores disponibles)
                # Pour M2: 8 cores standard, 10-12 cores Pro/Max
                # Ou spécifie un nombre exact: 4, 8, etc.
batch_size: 100  # Nombre d'itérations par batch (100 est optimal pour la plupart des cas)

# Linear MCCFR parameters
use_linear_weighting: true
discount_interval: 1000  # Apply discounting every N iterations
regret_discount_alpha: 1.0  # Regret discount factor (α) - 1.0 means no discount
strategy_discount_beta: 1.0  # Strategy discount factor (β) - 1.0 means no discount

# Exploration avec epsilon schedule optimisé pour 5h
# Active schedule tuned for a ~5h run (~2.0–2.5M iterations on M2 @ ~120–140 iter/s)
# AVEC parallélisation, on peut atteindre ~500-800 iter/s, donc ~9M-14M iterations en 5h!
epsilon_schedule:
  - [0,        0.60]  # bootstrap exploration
  - [200000,   0.35]  # stabilize faster for short run
  - [1000000,  0.20]
  - [2000000,  0.10]
  - [5000000,  0.05]  # Ajouté pour les runs plus longs avec parallélisation

# Dynamic pruning (Pluribus paper values)
enable_pruning: true
pruning_threshold: -300000000.0  # -300M as per Pluribus paper
pruning_probability: 0.95  # Skip iteration with 95% probability when all actions below threshold

# Notes d'utilisation:
# 
# Lancer avec cette configuration:
#   python -m holdem.cli.train_blueprint \
#       --config configs/blueprint_training_5h_parallel.yaml \
#       --buckets assets/abstraction/precomputed_buckets.pkl \
#       --logdir runs/5h_parallel
#
# Vous pouvez aussi surcharger num_workers via la ligne de commande:
#   --num-workers 4   (utilise 4 workers)
#   --num-workers 0   (auto-detect)
#   --num-workers 1   (mode simple processus, pas de parallélisation)
#
# Performance attendue sur Mac M2:
#   - M2 standard (8 cores): ~600-800 iter/s → ~10M-14M iterations en 5h
#   - M2 Pro (10-12 cores): ~800-1000 iter/s → ~14M-18M iterations en 5h
#   - M2 Max (12 cores): ~900-1200 iter/s → ~16M-21M iterations en 5h
#
# Comparé à l'ancien mode single-process (~120-140 iter/s → ~2M-2.5M iterations en 5h),
# la parallélisation vous donne 5-8x plus d'itérations dans le même temps!
